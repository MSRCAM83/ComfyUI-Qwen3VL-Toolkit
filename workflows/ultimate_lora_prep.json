{
  "last_node_id": 14,
  "last_link_id": 20,
  "nodes": [
    {
      "id": 1,
      "type": "QVL_LoadImages",
      "pos": [50, 300],
      "size": [300, 130],
      "properties": {},
      "widgets_values": ["/workspace/images", 256, 0, "name"],
      "outputs": [
        {"name": "images", "type": "IMAGE", "links": [1], "slot_index": 0},
        {"name": "filenames", "type": "STRING", "links": [2], "slot_index": 1},
        {"name": "count", "type": "INT", "links": null, "slot_index": 2}
      ]
    },
    {
      "id": 2,
      "type": "QVL_Dedup",
      "pos": [420, 300],
      "size": [280, 130],
      "properties": {},
      "widgets_values": [6, 16],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 1},
        {"name": "filenames", "type": "STRING", "link": 2}
      ],
      "outputs": [
        {"name": "kept", "type": "IMAGE", "links": [3], "slot_index": 0},
        {"name": "removed", "type": "IMAGE", "links": [15], "slot_index": 1},
        {"name": "kept_filenames", "type": "STRING", "links": [4], "slot_index": 2},
        {"name": "kept_count", "type": "INT", "links": null, "slot_index": 3},
        {"name": "removed_count", "type": "INT", "links": null, "slot_index": 4}
      ]
    },
    {
      "id": 3,
      "type": "QVL_QualityScore",
      "pos": [770, 300],
      "size": [280, 110],
      "properties": {},
      "widgets_values": [30.0, 256],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 3},
        {"name": "filenames", "type": "STRING", "link": 4}
      ],
      "outputs": [
        {"name": "passed", "type": "IMAGE", "links": [5], "slot_index": 0},
        {"name": "failed", "type": "IMAGE", "links": [16], "slot_index": 1},
        {"name": "passed_filenames", "type": "STRING", "links": [6], "slot_index": 2},
        {"name": "score_log", "type": "STRING", "links": null, "slot_index": 3},
        {"name": "passed_count", "type": "INT", "links": null, "slot_index": 4},
        {"name": "failed_count", "type": "INT", "links": null, "slot_index": 5}
      ]
    },
    {
      "id": 4,
      "type": "QVL_Filter",
      "pos": [1120, 300],
      "size": [300, 170],
      "properties": {},
      "widgets_values": ["huihui_ai/qwen2.5-vl-abliterated:7b", "http://127.0.0.1:11434", 5, "", "", "ollama"],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 5},
        {"name": "filenames", "type": "STRING", "link": 6}
      ],
      "outputs": [
        {"name": "kept", "type": "IMAGE", "links": [7], "slot_index": 0},
        {"name": "rejected", "type": "IMAGE", "links": [17], "slot_index": 1},
        {"name": "kept_filenames", "type": "STRING", "links": [8], "slot_index": 2},
        {"name": "filter_log", "type": "STRING", "links": null, "slot_index": 3},
        {"name": "kept_count", "type": "INT", "links": null, "slot_index": 4},
        {"name": "rejected_count", "type": "INT", "links": null, "slot_index": 5}
      ]
    },
    {
      "id": 5,
      "type": "QVL_Analyze",
      "pos": [1500, 300],
      "size": [320, 170],
      "properties": {},
      "widgets_values": ["huihui_ai/qwen2.5-vl-abliterated:32b", "http://127.0.0.1:11434", "", "", "ollama"],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 7},
        {"name": "filenames", "type": "STRING", "link": 8}
      ],
      "outputs": [
        {"name": "images", "type": "IMAGE", "links": [9], "slot_index": 0},
        {"name": "metadata_json", "type": "STRING", "links": [10, 11, 18], "slot_index": 1},
        {"name": "analysis_log", "type": "STRING", "links": null, "slot_index": 2},
        {"name": "count", "type": "INT", "links": null, "slot_index": 3}
      ]
    },
    {
      "id": 6,
      "type": "QVL_AutoCorrect",
      "pos": [1900, 200],
      "size": [280, 150],
      "properties": {},
      "widgets_values": [true, true, true, true],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 9},
        {"name": "metadata_json", "type": "STRING", "link": 10}
      ],
      "outputs": [
        {"name": "corrected", "type": "IMAGE", "links": [12], "slot_index": 0},
        {"name": "correction_log", "type": "STRING", "links": null, "slot_index": 1},
        {"name": "count", "type": "INT", "links": null, "slot_index": 2}
      ]
    },
    {
      "id": 7,
      "type": "QVL_SmartCrop",
      "pos": [2260, 200],
      "size": [280, 130],
      "properties": {},
      "widgets_values": [5, true, "keep_original"],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 12},
        {"name": "metadata_json", "type": "STRING", "link": 11}
      ],
      "outputs": [
        {"name": "cropped", "type": "IMAGE", "links": [13], "slot_index": 0},
        {"name": "crop_log", "type": "STRING", "links": null, "slot_index": 1},
        {"name": "count", "type": "INT", "links": null, "slot_index": 2}
      ]
    },
    {
      "id": 8,
      "type": "QVL_Caption",
      "pos": [1900, 500],
      "size": [300, 170],
      "properties": {},
      "widgets_values": ["huihui_ai/qwen2.5-vl-abliterated:32b", "http://127.0.0.1:11434", "flux2", "", "", "", "ollama"],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 7}
      ],
      "outputs": [
        {"name": "images", "type": "IMAGE", "links": null, "slot_index": 0},
        {"name": "captions_json", "type": "STRING", "links": [19], "slot_index": 1},
        {"name": "caption_preview", "type": "STRING", "links": null, "slot_index": 2},
        {"name": "count", "type": "INT", "links": null, "slot_index": 3}
      ]
    },
    {
      "id": 9,
      "type": "QVL_Resize",
      "pos": [2620, 200],
      "size": [240, 100],
      "properties": {},
      "widgets_values": [1024, "crop_center"],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 13}
      ],
      "outputs": [
        {"name": "resized", "type": "IMAGE", "links": [14], "slot_index": 0},
        {"name": "count", "type": "INT", "links": null, "slot_index": 2}
      ]
    },
    {
      "id": 10,
      "type": "QVL_SaveDataset",
      "pos": [2940, 300],
      "size": [300, 150],
      "properties": {},
      "widgets_values": ["/workspace/dataset", "png", 95, "", "", ""],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 14},
        {"name": "captions_json", "type": "STRING", "link": 19}
      ],
      "outputs": [
        {"name": "output_path", "type": "STRING", "links": null, "slot_index": 0},
        {"name": "count", "type": "INT", "links": null, "slot_index": 1}
      ]
    },
    {
      "id": 11,
      "type": "QVL_MetadataRouter",
      "pos": [1900, 750],
      "size": [280, 120],
      "properties": {},
      "widgets_values": ["pose", "standing,sitting"],
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 7},
        {"name": "metadata_json", "type": "STRING", "link": 18}
      ],
      "outputs": [
        {"name": "matched", "type": "IMAGE", "links": null, "slot_index": 0},
        {"name": "unmatched", "type": "IMAGE", "links": null, "slot_index": 1},
        {"name": "matched_count", "type": "INT", "links": null, "slot_index": 2},
        {"name": "unmatched_count", "type": "INT", "links": null, "slot_index": 3}
      ]
    },
    {
      "id": 12,
      "type": "PreviewImage",
      "pos": [770, 550],
      "size": [240, 240],
      "properties": {},
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 15}
      ],
      "title": "Removed Dupes"
    },
    {
      "id": 13,
      "type": "PreviewImage",
      "pos": [1120, 600],
      "size": [240, 240],
      "properties": {},
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 16}
      ],
      "title": "Failed Quality"
    },
    {
      "id": 14,
      "type": "PreviewImage",
      "pos": [1500, 600],
      "size": [240, 240],
      "properties": {},
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 17}
      ],
      "title": "VLM Rejected"
    }
  ],
  "links": [
    [1, 1, 0, 2, 0, "IMAGE"],
    [2, 1, 1, 2, 1, "STRING"],
    [3, 2, 0, 3, 0, "IMAGE"],
    [4, 2, 2, 3, 1, "STRING"],
    [5, 3, 0, 4, 0, "IMAGE"],
    [6, 3, 2, 4, 1, "STRING"],
    [7, 4, 0, 5, 0, "IMAGE"],
    [8, 4, 2, 5, 1, "STRING"],
    [9, 5, 0, 6, 0, "IMAGE"],
    [10, 5, 1, 6, 1, "STRING"],
    [11, 5, 1, 7, 1, "STRING"],
    [12, 6, 0, 7, 0, "IMAGE"],
    [13, 7, 0, 9, 0, "IMAGE"],
    [14, 9, 0, 10, 0, "IMAGE"],
    [15, 2, 1, 12, 0, "IMAGE"],
    [16, 3, 1, 13, 0, "IMAGE"],
    [17, 4, 1, 14, 0, "IMAGE"],
    [18, 5, 1, 11, 1, "STRING"],
    [19, 8, 1, 10, 1, "STRING"],
    [20, 4, 0, 8, 0, "IMAGE"]
  ],
  "groups": [
    {
      "title": "1. INPUT & CLEANUP",
      "bounding": [30, 220, 720, 260],
      "color": "#3f789e"
    },
    {
      "title": "2. FILTER (8B Fast)",
      "bounding": [750, 220, 700, 260],
      "color": "#b58b2b"
    },
    {
      "title": "3. ANALYZE (37B Deep)",
      "bounding": [1480, 220, 360, 260],
      "color": "#a1309b"
    },
    {
      "title": "4. CORRECT + CROP + RESIZE",
      "bounding": [1880, 120, 510, 300],
      "color": "#2b8c3f"
    },
    {
      "title": "5. CAPTION + SAVE",
      "bounding": [1880, 420, 1400, 200],
      "color": "#8c2b2b"
    },
    {
      "title": "REJECTED PREVIEWS",
      "bounding": [750, 470, 1020, 400],
      "color": "#555555"
    },
    {
      "title": "OPTIONAL: Sort by Metadata",
      "bounding": [1880, 680, 420, 220],
      "color": "#555555"
    }
  ],
  "config": {},
  "extra": {
    "ds": {
      "scale": 0.7,
      "offset": [0, 0]
    },
    "info": {
      "name": "Ultimate LoRA Prep Pipeline",
      "description": "Full dataset preparation: Load → Dedup → Quality Score → VLM Filter (8B) → Deep Analyze (37B) → Auto Correct → Smart Crop → Caption → Resize → Save. Includes preview nodes for rejected images and optional metadata routing for sorting by pose/angle/etc.",
      "author": "ComfyUI-Qwen3VL-Toolkit"
    }
  }
}
