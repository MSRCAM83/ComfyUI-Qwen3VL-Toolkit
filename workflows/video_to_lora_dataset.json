{
  "id": "video-to-lora-dataset",
  "revision": 0,
  "last_node_id": 11,
  "last_link_id": 16,
  "nodes": [
    {
      "id": 1,
      "type": "QVL_LoadVideoFrames",
      "pos": [50, 300],
      "size": [360, 290],
      "flags": {},
      "order": 0,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {"name": "frames", "type": "IMAGE", "links": [1], "slot_index": 0},
        {"name": "filenames", "type": "STRING", "links": [2], "slot_index": 1},
        {"name": "kept_count", "type": "INT", "links": [], "slot_index": 2},
        {"name": "total_extracted", "type": "INT", "links": [], "slot_index": 3}
      ],
      "properties": {"Node name for S&R": "QVL_LoadVideoFrames"},
      "widgets_values": ["/workspace/videos/input.mp4", "scene_detect", 1.0, 0.3, 500, true, 8, "/workspace/frames", 256]
    },
    {
      "id": 2,
      "type": "QVL_QualityScore",
      "pos": [480, 300],
      "size": [290, 150],
      "flags": {},
      "order": 1,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 1},
        {"name": "filenames", "type": "STRING", "link": 2}
      ],
      "outputs": [
        {"name": "passed", "type": "IMAGE", "links": [3], "slot_index": 0},
        {"name": "failed", "type": "IMAGE", "links": [12], "slot_index": 1},
        {"name": "passed_filenames", "type": "STRING", "links": [4], "slot_index": 2},
        {"name": "score_log", "type": "STRING", "links": [], "slot_index": 3},
        {"name": "passed_count", "type": "INT", "links": [], "slot_index": 4},
        {"name": "failed_count", "type": "INT", "links": [], "slot_index": 5}
      ],
      "properties": {"Node name for S&R": "QVL_QualityScore"},
      "widgets_values": [30.0, 256]
    },
    {
      "id": 3,
      "type": "QVL_Filter",
      "pos": [840, 300],
      "size": [310, 200],
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 3},
        {"name": "filenames", "type": "STRING", "link": 4}
      ],
      "outputs": [
        {"name": "kept", "type": "IMAGE", "links": [5, 14], "slot_index": 0},
        {"name": "rejected", "type": "IMAGE", "links": [13], "slot_index": 1},
        {"name": "kept_filenames", "type": "STRING", "links": [6], "slot_index": 2},
        {"name": "filter_log", "type": "STRING", "links": [], "slot_index": 3},
        {"name": "kept_count", "type": "INT", "links": [], "slot_index": 4},
        {"name": "rejected_count", "type": "INT", "links": [], "slot_index": 5}
      ],
      "properties": {"Node name for S&R": "QVL_Filter"},
      "widgets_values": ["huihui_ai/qwen2.5-vl-abliterated:7b", "http://127.0.0.1:11434", 5, "", "[]", "ollama"]
    },
    {
      "id": 4,
      "type": "QVL_Analyze",
      "pos": [1220, 300],
      "size": [330, 200],
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 5},
        {"name": "filenames", "type": "STRING", "link": 6}
      ],
      "outputs": [
        {"name": "images", "type": "IMAGE", "links": [7], "slot_index": 0},
        {"name": "metadata_json", "type": "STRING", "links": [8, 9], "slot_index": 1},
        {"name": "analysis_log", "type": "STRING", "links": [], "slot_index": 2},
        {"name": "count", "type": "INT", "links": [], "slot_index": 3}
      ],
      "properties": {"Node name for S&R": "QVL_Analyze"},
      "widgets_values": ["huihui_ai/qwen2.5-vl-abliterated:32b", "http://127.0.0.1:11434", "", "[]", "ollama"]
    },
    {
      "id": 5,
      "type": "QVL_AutoCorrect",
      "pos": [1620, 200],
      "size": [290, 180],
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 7},
        {"name": "metadata_json", "type": "STRING", "link": 8}
      ],
      "outputs": [
        {"name": "corrected", "type": "IMAGE", "links": [10], "slot_index": 0},
        {"name": "correction_log", "type": "STRING", "links": [], "slot_index": 1},
        {"name": "count", "type": "INT", "links": [], "slot_index": 2}
      ],
      "properties": {"Node name for S&R": "QVL_AutoCorrect"},
      "widgets_values": [true, true, true, true]
    },
    {
      "id": 6,
      "type": "QVL_SmartCrop",
      "pos": [1980, 200],
      "size": [290, 160],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 10},
        {"name": "metadata_json", "type": "STRING", "link": 9}
      ],
      "outputs": [
        {"name": "cropped", "type": "IMAGE", "links": [11], "slot_index": 0},
        {"name": "crop_log", "type": "STRING", "links": [], "slot_index": 1},
        {"name": "count", "type": "INT", "links": [], "slot_index": 2}
      ],
      "properties": {"Node name for S&R": "QVL_SmartCrop"},
      "widgets_values": [5, true, "keep_original"]
    },
    {
      "id": 7,
      "type": "QVL_Resize",
      "pos": [2340, 200],
      "size": [250, 110],
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 11}
      ],
      "outputs": [
        {"name": "resized", "type": "IMAGE", "links": [15], "slot_index": 0},
        {"name": "count", "type": "INT", "links": [], "slot_index": 1}
      ],
      "properties": {"Node name for S&R": "QVL_Resize"},
      "widgets_values": [1024, "crop_center"]
    },
    {
      "id": 8,
      "type": "QVL_Caption",
      "pos": [1620, 500],
      "size": [310, 200],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 14}
      ],
      "outputs": [
        {"name": "images", "type": "IMAGE", "links": [], "slot_index": 0},
        {"name": "captions_json", "type": "STRING", "links": [16], "slot_index": 1},
        {"name": "caption_preview", "type": "STRING", "links": [], "slot_index": 2},
        {"name": "count", "type": "INT", "links": [], "slot_index": 3}
      ],
      "properties": {"Node name for S&R": "QVL_Caption"},
      "widgets_values": ["huihui_ai/qwen2.5-vl-abliterated:32b", "http://127.0.0.1:11434", "flux2", "", "", "[]", "ollama"]
    },
    {
      "id": 9,
      "type": "QVL_SaveDataset",
      "pos": [2660, 300],
      "size": [310, 180],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 15},
        {"name": "captions_json", "type": "STRING", "link": 16}
      ],
      "outputs": [
        {"name": "output_path", "type": "STRING", "links": [], "slot_index": 0},
        {"name": "count", "type": "INT", "links": [], "slot_index": 1}
      ],
      "properties": {"Node name for S&R": "QVL_SaveDataset"},
      "widgets_values": ["/workspace/dataset", "png", 95, "[]", "[]", ""]
    },
    {
      "id": 10,
      "type": "PreviewImage",
      "pos": [480, 560],
      "size": [250, 250],
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 12}
      ],
      "outputs": [],
      "title": "Failed Quality",
      "properties": {"Node name for S&R": "PreviewImage"},
      "widgets_values": []
    },
    {
      "id": 11,
      "type": "PreviewImage",
      "pos": [840, 620],
      "size": [250, 250],
      "flags": {},
      "order": 10,
      "mode": 0,
      "inputs": [
        {"name": "images", "type": "IMAGE", "link": 13}
      ],
      "outputs": [],
      "title": "VLM Rejected",
      "properties": {"Node name for S&R": "PreviewImage"},
      "widgets_values": []
    }
  ],
  "links": [
    [1,  1, 0, 2, 0, "IMAGE"],
    [2,  1, 1, 2, 1, "STRING"],
    [3,  2, 0, 3, 0, "IMAGE"],
    [4,  2, 2, 3, 1, "STRING"],
    [5,  3, 0, 4, 0, "IMAGE"],
    [6,  3, 2, 4, 1, "STRING"],
    [7,  4, 0, 5, 0, "IMAGE"],
    [8,  4, 1, 5, 1, "STRING"],
    [9,  4, 1, 6, 1, "STRING"],
    [10, 5, 0, 6, 0, "IMAGE"],
    [11, 6, 0, 7, 0, "IMAGE"],
    [12, 2, 1, 10, 0, "IMAGE"],
    [13, 3, 1, 11, 0, "IMAGE"],
    [14, 3, 0, 8, 0, "IMAGE"],
    [15, 7, 0, 9, 0, "IMAGE"],
    [16, 8, 1, 9, 1, "STRING"]
  ],
  "groups": [
    {
      "title": "1. VIDEO EXTRACT + DEDUP",
      "bounding": [30, 220, 420, 350],
      "color": "#3f789e",
      "font_size": 24
    },
    {
      "title": "2. QUALITY + VLM FILTER",
      "bounding": [460, 220, 720, 300],
      "color": "#b58b2b",
      "font_size": 24
    },
    {
      "title": "3. DEEP ANALYZE (32B)",
      "bounding": [1200, 220, 380, 300],
      "color": "#a1309b",
      "font_size": 24
    },
    {
      "title": "4. CORRECT + CROP + RESIZE",
      "bounding": [1600, 120, 620, 320],
      "color": "#2b8c3f",
      "font_size": 24
    },
    {
      "title": "5. CAPTION + SAVE",
      "bounding": [1600, 430, 1400, 300],
      "color": "#8c2b2b",
      "font_size": 24
    }
  ],
  "config": {},
  "extra": {
    "ds": {
      "scale": 0.55,
      "offset": [100, 50]
    },
    "info": {
      "name": "Video to LoRA Dataset",
      "description": "Video (any size) -> scene detect + dedup -> quality filter -> VLM filter (7B) -> deep analyze (32B) -> auto correct -> smart crop -> caption (flux) -> resize 1024 -> save with captions"
    }
  },
  "version": 0.4
}
